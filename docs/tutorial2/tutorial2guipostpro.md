# Tutorial 2: Postprocessing a convectively unstable LES ABL calculation

<!-- NOTE: The tutorial is actually generated by make_tutorial2postpro.py -->

**Contents**
- [Introduction](#introduction)
- [Postprocessing the ABL stat file](#postprocessing-the-abl-stat-file)
- [Plot the friction velocity and ABL forcing](#plot-the-friction-velocity-and-abl-forcing)
- [Plot the velocity profile](plot-the-velocity-profile)
- [Plot the sampling plane file](#plot-the-sampling-plane-file)

<!--INTROTEXTSETUP-->
## Introduction

This tutorial will demonstrate the following features:
- How to use `amrwind-frontend` to postprocess an LES ABL case.

**Note**  

This part of the tutorial assumes that you have already set up and run
the LES ABL calculation.  If not, take a look at the instructions in
the [setup tutorial](tutorial2guisetup.md).

<!--INTROTEXTEND-->

## Postprocessing the ABL stat file

The first thinig we'll do is to look at the ABL statistics file.  This
statistics file contains scalar and horizontally averaged profile
statistics collected from the run.  In the **ABL Postprocessing**
window, put in the following inputs.  Note that the **ABL Statistics
file** should be the location of the `abl_statistics00000.nc` file.

| Parameter           | Value             |
| ---                 | ---               |
| ABL Statistics file | `post_processing/abl_statistics00000.nc` |
| Avg times           | [15000, 20000]   |
| Avg heights         | 57.19   |

After putting in these values, the window should look like:  

![images/postpro_statsfile.png](images/postpro_statsfile.png)

To get a summary of the statistcs of the ABL at the height
`57.19`, press **[Print report]** at the bottom, then the
output in the command line window should look like:

```

Loading w'theta'_r
Loading theta
Loading u
Loading v'v'_r
Loading v
Loading u'u'_r
Loading w'w'_r
        z       Uhoriz      WindDir       TI_TKE     TI_horiz        Alpha     ObukhovL 
      ===         ====         ====         ====         ====         ====         ==== 
    57.19 6.129959e+00 2.300725e+02 6.614705e-02 1.035226e-01 2.969138e-02 -4.795765e+01 

```

## Plot the friction velocity and ABL forcing

Next we'll take a look at the time history of some scalars from the
ABL statistics file.  First we'll do the friction velocity.  Select
`ustar` in the **ABL Scalar Stats** selection box:

![images/postpro_selectustar.png](images/postpro_selectustar.png)

Then press the **[Plot scalars]** button.  You should see a plot which
looks like this:

![images/postpro_ablustar.png](images/postpro_ablustar.png)

Now unselect `ustar` from the selection box and scroll down to select
both `abl_forcing_x` and `abl_forcing_y`.  Then press the **[Plot
scalars]** button again.  The time history of the ABL forcing should
look similar to:

![images/postpro_ablforcing.png](images/postpro_ablforcing.png)

## Plot the velocity profile

Next we'll plot some time averaged and horizontally-averaged velocity
profiles.  Under **ABL Profile Stats**, select `Uhoriz`:

![images/postpro_selectuhoriz.png](images/postpro_selectuhoriz.png)

Then hit **[Plot profiles]**.  The averaged `Uhoriz` profile should look
like:

![images/postpro_abluhoriz.png](images/postpro_abluhoriz.png)

To look at the TKE, scroll down the **ABL Profile Stats** selection
window and choose TKE.  Then press **[Plot profiles]**, and the
averaged TKE profile should look like: 

![images/postpro_abltke.png](images/postpro_abltke.png)

## Plot the sampling plane file 

We can also use the `amrwind-frontend` program to visualize the
sampling outputs.  Scroll down to the **Plot Sample Planes** section,
then in the **NetCDF file** input, insert the location of the
`sampling00000.nc` file (or hit **Choose file** and select the file)
and then hit **[Load file]**.  Then it should load the available
NetCDF groups like in the image below:

![images/postpro_samplefile1.png](images/postpro_samplefile1.png)

For this example, select 'p_hub' and hit **[Load variables]**, and it
should load the available variables to plot:

![images/postpro_samplefile2.png](images/postpro_samplefile2.png)

Now put in the following parameters into the input fields:

| Parameter        | value                         |
| ---              | ---                           |
| NetCDF vars      | `velocityx`                   |
| Plot axis 1      | X     |
| Plot axis 2      | Y     |
| k-plane          | 0                             |
| Set current time | 400 |

The view should look like:

![images/postpro_samplefile3.png](images/postpro_samplefile3.png)

Then press the **[Plot sample]** button, and it should generate the
figure below:

![images/postpro_phub_u.png](images/postpro_phub_u.png)

This is an image of the x-velocity at the last time step.
