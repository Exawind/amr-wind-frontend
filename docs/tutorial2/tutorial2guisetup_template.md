# Tutorial 2: Setting up an LES ABL calculation

<!-- NOTE: The tutorial is actually generated by {makescript} -->

<!--INTROTEXTSETUP-->
## Introduction

This tutorial will demonstrate the following features: 
- How to use `amrwind-frontend` to set up an LES ABL case.

### Background

The desired conditions for this ABL case are derived from the IEA29
REF1 conditions measured off of the coast of Denmark.  

| Parameter                 | Value       |
| ---                       | ---         |
| Turbine hub height        | 57.19 m     |
| Hub height wind speed     | 6.1 m/s     |
| Hub height wind direction | 230 degrees |
| Hub height TI             | 0.068       |
| Hub height shear exponent | 0.0025      |
<!--INTROTEXTEND-->

## Simulation settings

In the **Simulation** tab, go to the **Simulation type** window, and 
choose `{incflo_physics}` for **Physics models**.

Then under the **Time control** section, set the following parameters:

| Parameter  | Value            |
| ---        | ---              |
| Max time   | {time_stop_time} |
| Max steps  | {time_max_step}  |
| March with | `{time_control}` |
| dt         | {time_fixed_dt}  |

Under **Restart parameters**, set **Check file** to `{io_check_file}`.
Then the settings at the top of the tab should look like:  

![{img_time_settings}]({img_time_settings})

Now in the **Fluid and transport properties** section, set the
following:

| Parameter         | Value                 |
| ---               | ---                   |
| Dynamic viscosity | {transport_viscosity} |

In the **Godunov parameters** section and the **Turbulence
parameters** section, set the following parameters:

| Parameter        | Value                 |
| ---              | ---                   |
| Use godunov      | {incflo_use_godunov}  |
| Godunov type     | {incflo_godunov_type} |
| Turbulence model | {turbulence_model}    |
| TKE source terms | {TKE_source_terms}    |

After setting these variables, the bottom part of the tab should look
like:

![{img_turb_settings}]({img_turb_settings})

## Domain and boundary conditions

In the **Domain** tab, we'll set the computational domain and boundary
conditions.

| Parameter       | Value              | Comment                               |
| ---             | ---                | ---                                   |
| Domain corner 1 | {geometry_prob_lo} |                                       |
| Domain corner 2 | {geometry_prob_hi} |                                       |
| Mesh size       | {amr_n_cell}       | Number of cells in X, Y, Z directions |
| Periodic in X   | {is_periodicx}     |                                       |
| Periodic in Y   | {is_periodicy}     |                                       |
| Periodic in Z   | {is_periodicz}     | Z is not periodic                     |


![{img_domain_settings}]({img_domain_settings})

Now we'll set the boundary conditions on the upper and lower Z
surfaces. Press **[show]** next to **Boundary conditions on Z faces**,
then use these parameter values in the following fields, and you can
leave the remainder of them blank.

| Parameter       | Value                  | Comment                          |
| ---             | ---                    | ---                              |
| zlo velocity BC | {zlo_type}             |                                  |
| zlo temp BC     | {zlo_temperature_type} |                                  |
| zlo TKE BC      | {zlo_tke_type}         |                                  |
| zhi velocity BC | {zhi_type}             |                                  |
| zhi temp BC     | {zhi_temperature_type} |                                  |
| zhi temperature | {zhi_temperature}      | This is actually the dT/dz value |


It should look like this in the front-end interface:
	
![{img_zBC_settings}]({img_zBC_settings})

## ABL settings

In the **ABL** tab, we'll add the necessary physical values for an ABL
simulation.  First in the **ABL Forcing** window, check the following
items:

| Parameter              | Value               |
| ---                    | ---                 |
| add ABL Forcing        | {ABLForcing}        |
| add Coriolis forces    | {CoriolisForcing}   |
| add Boussinesq forcing | {BoussinesqForcing} |

Next we'll set the ABL wind speed and direction.  In the **ABL
physics** section, use the following variables:

| Parameter      | Value                           |
| ---            | ---                             |
| Wind speed     | {ABL_windspeed}                 |
| Wind direction | {ABL_winddir}                   |
| Forcing height | {ABLForcing_abl_forcing_height} |

 Then hit the **[Calc W. Vec]** button, and it should automatically
 calculate the correct wind vector to use.

![{img_ABL_settings1}]({img_ABL_settings1})

![{img_ABL_settings2}]({img_ABL_settings2})

## IO settings

![{img_IO_settings}]({img_IO_settings})

![{img_phub_settings1}]({img_phub_settings1})

![{img_phub_settings2}]({img_phub_settings2})

![{img_xbc_settings1}]({img_xbc_settings1})

![{img_xbc_settings2}]({img_xbc_settings2})

![{img_ybc_settings1}]({img_ybc_settings1})

![{img_ybc_settings2}]({img_ybc_settings2})

## Expert settings

| Parameter                     | Value                           |
| ---                           | ---                             |
| nodal_proj.mg_rtol            | {nodal_proj_mg_rtol}            |
| nodal_proj.mg_atol            | {nodal_proj_mg_atol}            |
| mac_proj.mg_rtol              | {mac_proj_mg_rtol}              |
| mac_proj.mg_atol              | {mac_proj_mg_atol}              |
| diffusion.mg_rtol             | {diffusion_mg_rtol}             |
| diffusion.mg_atol             | {diffusion_mg_atol}             |
| temperature_diffusion.mg_rtol | {temperature_diffusion_mg_rtol} |
| temperature_diffusion.mg_atol | {temperature_diffusion_mg_atol} |

![{img_expert_settings}]({img_expert_settings})

## Plot of the domain

![{img_plotDomainWin_samplingzone}]({img_plotDomainWin_samplingzone})

![{img_plotDomainFig_sampling}]({img_plotDomainFig_sampling})

## Writing the input file

To see what the AMR-Wind input file would look like, you can go to the
menu bar, select **Run** --> **Preview Input File**, to see the
preview window (you can also just hit **File** --> **Save input file
as** to save it to a file).

<details>
  <summary>[input file]</summary>
<pre>
{amrwindinput1}
</pre>
</details>

